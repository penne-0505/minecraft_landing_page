---
title: Contract Page Requirements (Draft)
status: proposed
draft_status: exploring
created_at: 2025-12-07
updated_at: 2025-12-07
references:
  - ../plan/Membership/roadmap/plan.md
  - ../guide/design/design_tokens.md
---

## 目的
支援手続き前に、支援者表示とロール付与に関する同意を取得し、その後 Stripe Checkout へ遷移させる。デザインは後日デザイナーと確定し、ここでは機能要件のみを定義する。

## 要件
1. 同意確認
   - 項目: 「支援者として名前を表示する」「支援ロールを自動付与する」(必須/任意を明示)。
   - チェック未完了の場合は「Stripeへ進む」ボタンを非活性にする。
   - 同意状態は Stripe metadata に送信できる形で保持（実装時に create-checkout-session へ渡す）。
2. 認証前提
   - Discordログインが完了していない場合、ログイン導線を提示し、未ログインのまま決済に進ませない。
3. プラン選択動線
   - `/membership` で選択したプランと連動、または Contract ページ上で簡易プラン選択を提供する（UX設計時に決定）。
4. バリデーションとエラー表示
   - 同意未チェック時のメッセージ表示。
   - Stripeセッション生成失敗時のリトライ/問い合わせ導線。
5. ロール付与可否の明示
   - 付与を拒否した場合の影響（特典が一部使えない等）を表示。
6. アクセシビリティ
   - キーボード操作でトグル可能、ARIA属性を適切に付与。
7. ナビゲーション
   - 戻る（/membership）、規約（/legal/*）への導線をフッターまたはページ内に設置。
8. 後日デザイン差し替え可能な構造
   - レイアウトはコンポーネント分割し、トグル・ボタン部分をロジックと分離。

## 非スコープ
- Stripe 決済そのもののUI（Checkoutに委譲）。
- 返金ポリシー等の文面表示（/legal で対応）。

## 成功条件 (DoD)
- 未ログインでは決済ボタンが活性化しない。
- 同意2項目の状態を metadata に載せて Checkout セッションを生成できる（実装時）。
- エラー時のユーザー向けメッセージが表示される。
- /membership からの導線で迷わず到達できる（ナビ導線設定後に確認）。 
